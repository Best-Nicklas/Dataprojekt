---
title: "Dataprojet"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
n <- 1000
MAF <- runif(n,0.01,0.49)
person <- matrix(nrow=n, ncol=n)
for (i  in 1:n){
    person[i,] <- rbinom(n,2,MAF)
  }

person <- data.frame(person)
person
```

```{r}
Genome <- c("A","A","T","A","T","T")
dim(Genome) <- c(3,2)
n = 10
person <- matrix(nrow=n, ncol=n*2)
snp <- rbinom(n,2,runif(n,0.01,0.49))
for (i  in 1:n){
    person[i,] <- Genome[snp[i]+1,]
  }

# person <- data.frame(person)
person
```


```{r}
library(bigstatsr)
library(bigsnpr)
```

```{r}
G2 = FBM.code256(nrow = 1e2, # number of rows
                ncol = 1e2, # number of columns
                code = c(0L, 1L, 2L, rep(NA_integer_, 256 - 3)), # coding of FileBackedMatrix, here 0,1,2 and NA's.
                backingfile = "../Data/test_fbm") # where to save the matrix on disk?
```

```{r}
n <- 100
#G2 <- matrix(nrow=n, ncol=n)
#print(G2)
block <- matrix(nrow=block_size, ncol=n)
block_size <- 10
MAF <- runif(n,0.01,0.49)
for(i in 0:((n/block_size)-1)){
  #print("outer loop start")
  #print(i)
  block_start <- 1 + i*block_size
  block_end <- (1+i)*block_size
  for (j in 1:block_size){
    #print("inner loop")
    #print(j)
    block[j,] <- rbinom(n,2,MAF)
  }
  #if (i < 2){
  #  print(block[,1:10])
  }
  G2[block_start:block_end,] <- block
  #print("outer loop fin")
  #print(i)
  #print(G2)
}
#print("loop done")
MAF[1:2]
G2[1:20,1:10]
#G2[91:100,91:100]
```

```{r}
G2[1:10,1:10]
```

```{r}
G2[,1:10] <- matrix(0:2, ncol = 10, nrow = 1e5)
G2[1:10,1:10]
```


```{r}
library(dplyr)
#save bigsnp object:
#a list with 3 elements
obj.bigsnp = list(genotypes = G2, # genotypes, FBM object
                  map = tibble(snp = 1:ncol(G2)), # map, i.e. SNP info
                  fam = tibble(FID = 1:nrow(G2))) # fam, i.e. info on individuals
#saving the bigsnp object
snp_save(obj.bigsnp)
```

```{r}
#you can read the data with:
G3 = snp_attach("test_fbm.rds") # OBS: READ THE .rds(!!!) object
#genotypes are then stored in the .bk file.
```

