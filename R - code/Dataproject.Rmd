# Dataprojekt
```{r}
library(profvis)
library(bigstatsr)
library(bigsnpr)
library(dplyr)
```

```{r}
# FBM file
n <- 100000
Dataframe = FBM.code256(nrow = n, # number of rows
                 ncol = n, # number of columns
                 code = c(0L, 1L, 2L, rep(NA_integer_, 256 - 3)), # coding of FileBackedMatrix, here 0,1,2 and NA's.
                 backingfile = "../Data/dataframe") # where to save the matrix on disk?

```


```{r}
# Sim-code
set.seed(777) # Seed for reproduction of simulation
MAF <- runif(n,0.01,0.49)
block_size <- n/10
for(i in 0:((n/block_size)-1)){
  block_start <- 1 + i*block_size
  block_end <- (1+i)*block_size
  Dataframe[block_start:block_end,] <- matrix(nrow=block_size,rbinom(n*block_size,2,MAF))
}
```

```{r}
# Normalize data, and calculate liability 
# We designate the first c SNPs as causal for convenience. Simulated data means it doesn't matter.
set.seed(777)
c <- n*0.01 # 1% of SNPs are causal, which means 1000
h2 <- 0.8 # 80% heritability of illness
beta <- rnorm(c,0,h2/c)
beta_dummy <- c(rep(0,n)) # Used in creation of tibble
beta_dummy[1:c] <- beta
causal <- ifelse(beta_dummy != 0, 1, 0)

mu <- 2*MAF[1:c] # theoretical mean, because n big
sigma <- sqrt(2*MAF[1:c]*(1-MAF[1:c])) # theoretical sd, because n big

liab_g <- sweep(sweep(Dataframe[,1:c], MARGIN = 2, STATS = mu, FUN = "-"), MARGIN = 2, STATS = sigma, FUN = "/") %*% beta
liab_g
liab_e <- rnorm(n,0,1-h2)
liab_full <- liab_e+liab_g

threshold <- quantile(liab_full, 0.95)
```




```{r}
# GWAS

```

```{r}
# Tibbles
FAM <- tibble(ID = 1:n, Full_Liability = liab_full, Genetic_Liability = liab_g, Status = ifelse(liab_full > threshold,1,0))
MAP <- tibble(SNP_ID = 1:n, Minor_Allele_Frequency = MAF, BETA = beta_dummy, Causal = causal)
```

```{r}
Full_model <- c(Dataframe,FAM,MAP)
#snp_writeBed(Full_model, bedfile = "../Data/bigSNP")
```

